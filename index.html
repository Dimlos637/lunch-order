<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é€ å‹ä¸­é¤é»é¤ç³»çµ±</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f4f7f4; padding: 20px; font-family: "Microsoft JhengHei", sans-serif; }
    .order-card { background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); padding: 30px; max-width: 500px; margin: auto; }
    .btn-submit { background-color: #556b2f; color: white; width: 100%; border-radius: 25px; border: none; padding: 12px; font-weight: bold; }
    .price-tag { color: #556b2f; font-weight: bold; font-size: 1.4rem; }
    #paymentSection { background-color: #f0f4ee; border-left: 5px solid #556b2f; display: none; padding: 15px; border-radius: 8px; margin-top:10px; }
    .notice-box { background-color: #fff9db; border: 1px dashed #fab005; padding: 10px; border-radius: 8px; font-size: 0.9rem; color: #856404; }
  </style>
</head>
<body>
  <div class="container order-card">
    <div id="loading" class="text-center py-5">
      <div class="spinner-border text-success"></div>
      <p class="mt-2 text-secondary">æ­£åœ¨åŒæ­¥ä»Šæ—¥èœå–®...</p>
    </div>

    <div id="formSection" style="display:none;">
      <h3 class="text-center mb-1" id="resTitle" style="color: #556b2f; font-weight: 900;">è¼‰å…¥ä¸­...</h3>
      <p class="text-center text-secondary small mb-4">é€ å‹ä¸­é¤é»é¤ç³»çµ±</p>
      
      <form id="orderForm">
        <div class="mb-3">
          <label class="form-label fw-bold">æ‚¨çš„å§“å</label>
          <input type="text" id="userName" class="form-control" placeholder="è«‹è¼¸å…¥åå­—" required>
        </div>
        
        <div class="mb-3">
          <label class="form-label fw-bold">é¸æ“‡å“é …</label>
          <select id="menuSelect" class="form-select" required></select>
        </div>

        <div class="mb-3">
          <label class="form-label fw-bold">æ•¸é‡</label>
          <input type="number" id="quantityInput" class="form-control" value="1" min="1" required>
          <div id="priceDisplay" class="mt-2 text-end"></div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-bold">å‚™è¨»</label>
          <input type="text" id="note" class="form-control" placeholder="é£¯å°‘ã€åŠé£¯ã€æˆ–æ˜¯å¯«ã€Œå–æ¶ˆã€...">
        </div>

        <div class="mb-3 form-check">
          <input type="checkbox" class="form-check-input" id="paidCheck">
          <label class="form-check-label fw-bold" for="paidCheck" style="color: #556b2f;"> æˆ‘å·²ç¾å ´ç¹³è²» </label>
        </div>

        <div id="paymentSection">
          <label class="form-label small fw-bold">æ”¶å–é‡‘é¡</label>
          <input type="number" id="receivedAmount" class="form-control mb-2" placeholder="è¼¸å…¥é¢é¡ (å¦‚ 100, 500)">
          <div class="fw-bold" style="color: #8b4513;">æ‰¾é›¶ï¼š<span id="changeAmount">$0</span></div>
        </div>

        <div class="notice-box mt-4">
          <strong>ğŸ’¡ è²¼å¿ƒæé†’ï¼š</strong><br>
          å¦‚æ¬²ä¿®æ”¹è¨‚å–®ï¼Œç›´æ¥é‡æ–°ä¸‹å–®å³å¯è¦†è“‹èˆŠå–®ã€‚<br>
          <strong>å–æ¶ˆè¨‚å–®ï¼š</strong>è«‹é‡æ–°ä¸‹å–®ç›¸åŒå“é …ï¼Œä¸¦åœ¨å‚™è¨»å¯«ã€Œå–æ¶ˆã€æˆ–ã€Œä¸é»äº†ã€ã€‚
        </div>

        <button type="submit" id="submitBtn" class="btn btn-submit mt-3">ç¢ºèªä¸‹å–®</button>
      </form>
      <div id="msg" class="text-center mt-3 fw-bold text-success"></div>
    </div>

    <div id="closedSection" class="text-center py-5" style="display:none;">
      <h2 style="color: #556b2f; font-weight: bold;">ğŸ›‘ ä»Šæ—¥é»é¤å·²æˆªæ­¢</h2>
      <div class="mt-3 p-3 mx-auto" style="max-width: 300px; background-color: #fff5f5; border-radius: 15px; border: 1px solid #ffc9c9;">
        <p class="mb-1 fw-bold" style="color: #c92a2a;">ç³»çµ±é–‹æ”¾æ™‚é–“</p>
        <p class="mb-0 fs-5" style="color: #c92a2a; letter-spacing: 1px;">07:00 ~ 08:45</p>
      </div>
      <p class="text-secondary mt-4 small">ï¼ˆåƒ…é™é€±ä¸€è‡³é€±äº”ä¸Šç­æ—¥é–‹æ”¾ï¼‰</p>
    </div>

  <script>
    // è«‹ç¢ºèªæ­¤è™• URL èˆ‡æ‚¨æœ€æ–°éƒ¨ç½²çš„ GAS ç¶²å€ä¸€è‡´
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyueRiA8FDP84WutZ3XtQ-XyGbusGo4WFgV1Qwa0IqEOsSA3Uky44r9otrA30rqDJ7iYA/exec"; 
    let menuStore = [], currentUnitPrice = 0;

    window.onload = () => {
      fetch(GAS_URL).then(res => res.json()).then(data => {
        document.getElementById('loading').style.display = 'none';
        if (data.status !== "é–‹å•Ÿ") { document.getElementById('closedSection').style.display = 'block'; return; }
        document.getElementById('formSection').style.display = 'block';
        document.getElementById('resTitle').innerText = "ğŸ± ä»Šæ—¥é¤å»³ï¼š" + data.restaurant;
        menuStore = data.menu;
        const select = document.getElementById('menuSelect');
        select.add(new Option("-- è«‹é¸æ“‡ --", ""));
        data.menu.forEach((row, i) => { if(row[0]) { let opt = new Option(row[0], row[0]); opt.dataset.idx = i; select.add(opt); } });
      });
    };

    function updatePrice() {
      let qty = parseInt(document.getElementById('quantityInput').value) || 1;
      if (qty < 1) qty = 1;
      const total = currentUnitPrice * qty;
      if(currentUnitPrice > 0) {
        document.getElementById('priceDisplay').innerHTML = `å–®åƒ¹ $${currentUnitPrice} x ${qty} = ç¸½è¨ˆ <span class="price-tag">$${total}</span>`;
      }
      calcChange(total);
    }

    document.getElementById('menuSelect').onchange = function() {
      const idx = this.options[this.selectedIndex].dataset.idx;
      if (idx !== undefined) { 
        currentUnitPrice = menuStore[idx][1]; 
        updatePrice(); 
      }
    };

    document.getElementById('quantityInput').oninput = updatePrice;

    document.getElementById('paidCheck').onchange = function() {
      document.getElementById('paymentSection').style.display = this.checked ? 'block' : 'none';
    };

    function calcChange(total) {
      const received = parseFloat(document.getElementById('receivedAmount').value) || 0;
      const targetTotal = total || (currentUnitPrice * (parseInt(document.getElementById('quantityInput').value) || 1));
      const change = received - targetTotal;
      document.getElementById('changeAmount').innerText = change >= 0 ? `$${change}` : "é‡‘é¡ä¸è¶³";
    }

    document.getElementById('receivedAmount').oninput = () => updatePrice();

    document.getElementById('orderForm').onsubmit = function(e) {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      btn.disabled = true; btn.innerText = "å‚³é€ä¸­...";
      
      fetch(GAS_URL, {
        method: 'POST',
        body: JSON.stringify({
          userName: document.getElementById('userName').value,
          item: document.getElementById('menuSelect').value,
          price: currentUnitPrice,
          quantity: document.getElementById('quantityInput').value,
          note: document.getElementById('note').value,
          hasPaid: document.getElementById('paidCheck').checked,
          receivedAmount: document.getElementById('receivedAmount').value
        })
      }).then(res => res.json()).then(res => {
        document.getElementById('msg').innerText = res.result;
        this.reset(); btn.disabled = false; btn.innerText = "ç¢ºèªä¸‹å–®";
        document.getElementById('paymentSection').style.display = 'none';
        document.getElementById('priceDisplay').innerText = "";
        document.getElementById('quantityInput').value = 1;
      });
    };
  </script>
</body>
</html>




